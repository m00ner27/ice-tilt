<div class="player-stats-container">
  <h1 class="player-stats-title">Player Statistics</h1>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading-container">
    <p>Loading stats...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading">
    <!-- Season Selector -->
    <div class="filters-container">
      <label for="season-select">Season:</label>
      <select id="season-select" [(ngModel)]="selectedSeasonId" (ngModelChange)="onSeasonChange()">
        <option value="all-seasons">All-Time</option>
        <option *ngFor="let season of seasons" [value]="season._id">{{ season.name }}</option>
      </select>
    </div>

    <!-- Stats Tables per Division -->
    <div *ngFor="let group of groupedStats" class="division-group">
      <h2 *ngIf="selectedSeasonId !== 'all-seasons'" class="division-header">
        <img *ngIf="group.divisionData?.logoUrl" 
             [src]="getImageUrl(group.divisionData?.logoUrl)" 
             [alt]="group.division + ' logo'" 
             class="division-logo">
        {{ group.division }}
      </h2>
      
      <div class="player-stats-table-container">
        <table class="player-stats-table">
          <thead>
            <tr>
              <th class="sticky-column rank-column">Rank</th>
              <th class="sticky-column player-name" [ngClass]="getColumnSortClass('name')" (click)="onSortColumn('name')">Player</th>
              <th [ngClass]="getColumnSortClass('team')" (click)="onSortColumn('team')">Club</th>
              <th [className]="getColumnSortClass('position')" (click)="onSortColumn('position')">Pos</th>
              <th [className]="getColumnSortClass('gamesPlayed')" (click)="onSortColumn('gamesPlayed')">GP</th>
              <th [className]="getColumnSortClass('goals')" (click)="onSortColumn('goals')">G</th>
              <th [className]="getColumnSortClass('assists')" (click)="onSortColumn('assists')">A</th>
              <th [className]="getColumnSortClass('points')" (click)="onSortColumn('points')">PTS</th>
              <th [className]="getColumnSortClass('plusMinus')" (click)="onSortColumn('plusMinus')">+/-</th>
              <th [className]="getColumnSortClass('timeOnIce')" (click)="onSortColumn('timeOnIce')">TOI</th>
              <th [className]="getColumnSortClass('shots')" (click)="onSortColumn('shots')">S</th>
              <th [className]="getColumnSortClass('shotPercentage')" (click)="onSortColumn('shotPercentage')">S%</th>
              <th [className]="getColumnSortClass('hits')" (click)="onSortColumn('hits')">H</th>
              <th [className]="getColumnSortClass('blockedShots')" (click)="onSortColumn('blockedShots')">BS</th>
              <th [className]="getColumnSortClass('penaltyMinutes')" (click)="onSortColumn('penaltyMinutes')">PIM</th>
              <th [className]="getColumnSortClass('powerPlayGoals')" (click)="onSortColumn('powerPlayGoals')">PPG</th>
              <th [className]="getColumnSortClass('shortHandedGoals')" (click)="onSortColumn('shortHandedGoals')">SHG</th>
              <th [className]="getColumnSortClass('gameWinningGoals')" (click)="onSortColumn('gameWinningGoals')">GWG</th>
              <th [className]="getColumnSortClass('takeaways')" (click)="onSortColumn('takeaways')">TK</th>
              <th [className]="getColumnSortClass('giveaways')" (click)="onSortColumn('giveaways')">GV</th>
              <th [className]="getColumnSortClass('passes')" (click)="onSortColumn('passes')">P</th>
              <th [className]="getColumnSortClass('passPercentage')" (click)="onSortColumn('passPercentage')">P%</th>
              <th [className]="getColumnSortClass('faceoffsWon')" (click)="onSortColumn('faceoffsWon')">FOW</th>
              <th [className]="getColumnSortClass('faceoffPercentage')" (click)="onSortColumn('faceoffPercentage')">FO%</th>
              <th [className]="getColumnSortClass('playerScore')" (click)="onSortColumn('playerScore')">PS</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let player of group.stats; let i = index">
              <td class="sticky-column rank-column">{{ i + 1 }}</td>
              <td class="sticky-column player-name">
                <img [src]="player.teamLogo" class="player-logo" [alt]="player.team + ' logo'">
                {{ player.name }}
              </td>
              <td class="team-cell">
                <span class="team-name">{{ player.team }}</span>
              </td>
              <td>{{ player.position }}</td>
              <td>{{ player.gamesPlayed }}</td>
              <td>{{ player.goals }}</td>
              <td>{{ player.assists }}</td>
              <td class="points-column">{{ player.points }}</td>
              <td [ngClass]="{'positive': player.plusMinus > 0, 'negative': player.plusMinus < 0}">
                {{ player.plusMinus > 0 ? '+' : '' }}{{ player.plusMinus }}
              </td>
              <td>{{ formatTimeOnIce(player.timeOnIce) }}</td>
              <td>{{ player.shots }}</td>
              <td>{{ player.shotPercentage }}%</td>
              <td>{{ player.hits }}</td>
              <td>{{ player.blockedShots }}</td>
              <td>{{ player.penaltyMinutes }}</td>
              <td>{{ player.powerPlayGoals }}</td>
              <td>{{ player.shortHandedGoals }}</td>
              <td>{{ player.gameWinningGoals }}</td>
              <td>{{ player.takeaways }}</td>
              <td>{{ player.giveaways }}</td>
              <td>{{ player.passes }}</td>
              <td>{{ player.passPercentage }}%</td>
              <td>{{ player.faceoffsWon }}</td>
              <td>{{ player.faceoffPercentage }}%</td>
              <td>{{ player.playerScore }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- No Stats Message -->
    <div *ngIf="groupedStats.length === 0" class="no-data-container">
      <p>No player statistics available for the selected season.</p>
    </div>
  </div>
</div>
