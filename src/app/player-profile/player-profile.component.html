<div class="profile-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading player profile...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <p>{{ error }}</p>
    <button routerLink="/players" class="back-button">Back to Players</button>
  </div>

  <!-- Player Profile Content -->
  <div *ngIf="!loading && !error && player" class="profile-content">
    <!-- Header Section -->
    <div class="profile-header">
      <div class="profile-header-row">
        <div class="header-top-row">
          <div class="header-left">
            <img *ngIf="player.clubLogo" [src]="player.clubLogo" [alt]="player.currentClubName" class="team-logo-profile">
            <div>
              <h1>
                {{ player.discordUsername }}<span class="player-number" *ngIf="player.number"> {{ player.number }}</span>
              </h1>
              <p *ngIf="player.currentClubName" class="player-club-name">{{ player.currentClubName }}</p>
            </div>
          </div>
          <div class="header-right">
            <div class="player-status" [ngClass]="player.status.toLowerCase()">
              {{ player.status }}
            </div>
          </div>
        </div>
      </div>
      <div class="player-details">
        <div class="details-header">
          <h3>Player Information</h3>
        </div>
        
        <div class="details-list">
          <div class="list-item">
            <span class="list-icon">üèí</span>
            <span class="secondary-label">Position:</span>
            <app-position-pill [position]="player.position"></app-position-pill>
            <ng-container *ngIf="player.secondaryPositions && player.secondaryPositions.length">
              <span class="secondary-label">Secondary:</span>
              <ng-container *ngFor="let pos of player.secondaryPositions">
                <app-position-pill [position]="pos"></app-position-pill>
              </ng-container>
            </ng-container>
          </div>
          
          <div class="list-item">
            <span class="list-icon">‚úã</span>
            <span class="secondary-label">Handedness:</span>
            <span class="list-value">{{ player.handedness }}</span>
          </div>
          
          <div class="list-item" *ngIf="player.country">
            <span class="list-icon">üåç</span>
            <span class="secondary-label">Country:</span>
            <span class="list-value">{{ countryEmojiMap[player.country] }} {{ player.country }}</span>
          </div>
          
          <div class="list-item">
            <span class="list-icon">üìä</span>
            <span class="secondary-label">Stats:</span>
            <span class="list-value">{{ careerTotals?.gamesPlayed || 0 }} Games ‚Ä¢ {{ careerTotals?.points || 0 }} Points ‚Ä¢ {{ careerTotals?.goals || 0 }} Goals</span>
          </div>
          
          <div class="list-item" *ngIf="player.platform">
            <span class="list-icon">üéÆ</span>
            <span class="secondary-label">Platform:</span>
            <span class="list-value">{{ player.platform }}</span>
          </div>
        </div>
      </div>
      
      <!-- Career Clubs Section -->
      <div class="career-clubs-section" *ngIf="allClubs.length > 0">
        <div class="detail-item">
          <span class="label">Career Clubs:</span>
          <div class="career-clubs-logos">
            <div *ngFor="let club of getCareerClubs()" class="career-club-item">
              <img [src]="getImageUrl(club.logoUrl)" [alt]="club.name" class="career-club-logo" 
                   [title]="club.name" onerror="this.style.display='none'"
                   (click)="navigateToClub(club._id)" 
                   [ngClass]="{'clickable': true}">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Gaming ID Section -->
    <div class="gaming-ids-section" *ngIf="player.psnId || player.xboxGamertag || player.gamertag">
      <h2>Gaming ID</h2>
      <div class="gaming-ids">
        <div class="id-item" *ngIf="player.psnId">
          <img src="assets/images/playstation-logo.svg" alt="PlayStation" class="platform-logo">
          <span class="platform">PSN:</span>
          <span class="id">{{ player.psnId }}</span>
        </div>
        <div class="id-item" *ngIf="player.xboxGamertag">
          <img src="assets/images/xbox-logo.svg" alt="Xbox" class="platform-logo">
          <span class="platform">Xbox:</span>
          <span class="id">{{ player.xboxGamertag }}</span>
        </div>
        <div class="id-item" *ngIf="player.gamertag && !player.psnId && !player.xboxGamertag">
          <span class="platform">Gamertag:</span>
          <span class="id">{{ player.gamertag }}</span>
        </div>
      </div>
    </div>



    <!-- Career Statistics Section -->
    <div class="career-stats-section" *ngIf="careerStats.length > 0">
      <h2>Career Statistics</h2>
      
      <!-- Career Totals -->
      <div class="career-totals">
        <h3>Career Totals</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value">{{ careerTotals.gamesPlayed }}</div>
            <div class="stat-label">Games Played</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ careerTotals.goals }}</div>
            <div class="stat-label">Goals</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ careerTotals.assists }}</div>
            <div class="stat-label">Assists</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ careerTotals.points }}</div>
            <div class="stat-label">Points</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ careerTotals.plusMinus }}</div>
            <div class="stat-label">+/-</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ careerTotals.shots }}</div>
            <div class="stat-label">Shots</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ careerTotals.hits }}</div>
            <div class="stat-label">Hits</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ careerTotals.pim }}</div>
            <div class="stat-label">PIM</div>
          </div>
        </div>
      </div>

      <!-- Season-by-Season Breakdown -->
      <div class="season-breakdown">
        <h2>Season Breakdown</h2>
        <div class="season-table-container">
          <table class="season-table">
            <thead>
              <tr>
                <th>Season</th>
                <th>Club</th>
                <th>GP</th>
                <th>W</th>
                <th>L</th>
                <th>OTL</th>
                <th>G</th>
                <th>A</th>
                <th>P</th>
                <th>+/-</th>
                <th>S</th>
                <th>H</th>
                <th>PIM</th>
                <th>PPG</th>
                <th>SHG</th>
                <th>GWG</th>
                <th>FO Won</th>
                <th>FO Lost</th>
                <th>BS</th>
                <th>INT</th>
                <th>TK</th>
                <th>GV</th>
                <th>DEF</th>
                <th>PD</th>
                <th>SA</th>
                <th>Shot %</th>
                <th>PA</th>
                <th>PC</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let season of careerStats" class="season-row">
                <td class="season-name">{{ season.seasonName }}</td>
                <td class="team-info">
                  <img [src]="season.clubLogo" [alt]="season.clubName" class="team-logo">
                  <span class="team-name">{{ season.clubName }}</span>
                </td>
                <td class="stat-value">{{ season.stats.gamesPlayed }}</td>
                <td class="stat-value">{{ season.stats.wins }}</td>
                <td class="stat-value">{{ season.stats.losses }}</td>
                <td class="stat-value">{{ season.stats.overtimeLosses || 0 }}</td>
                <td class="stat-value">{{ season.stats.goals }}</td>
                <td class="stat-value">{{ season.stats.assists }}</td>
                <td class="stat-value">{{ season.stats.points }}</td>
                <td class="stat-value">{{ season.stats.plusMinus }}</td>
                <td class="stat-value">{{ season.stats.shots }}</td>
                <td class="stat-value">{{ season.stats.hits }}</td>
                <td class="stat-value">{{ season.stats.pim }}</td>
                <td class="stat-value">{{ season.stats.ppg }}</td>
                <td class="stat-value">{{ season.stats.shg }}</td>
                <td class="stat-value">{{ season.stats.gwg }}</td>
                <td class="stat-value">{{ season.stats.faceoffsWon }}</td>
                <td class="stat-value">{{ season.stats.faceoffsLost }}</td>
                <td class="stat-value">{{ season.stats.blockedShots }}</td>
                <td class="stat-value">{{ season.stats.interceptions }}</td>
                <td class="stat-value">{{ season.stats.takeaways }}</td>
                <td class="stat-value">{{ season.stats.giveaways }}</td>
                <td class="stat-value">{{ season.stats.deflections }}</td>
                <td class="stat-value">{{ season.stats.penaltiesDrawn }}</td>
                <td class="stat-value">{{ season.stats.shotAttempts }}</td>
                <td class="stat-value">{{ (season.stats.shotPct || 0) | number:'1.1-1' }}%</td>
                <td class="stat-value">{{ season.stats.passAttempts }}</td>
                <td class="stat-value">{{ season.stats.passesCompleted }}</td>
              </tr>
              
              <!-- Career Totals Row -->
              <tr class="career-totals-row">
                <td class="season-name">CAREER</td>
                <td class="team-info">
                  <span class="team-name">TOTALS</span>
                </td>
                <td class="stat-value">{{ careerTotals.gamesPlayed }}</td>
                <td class="stat-value">{{ careerTotals.wins }}</td>
                <td class="stat-value">{{ careerTotals.losses }}</td>
                <td class="stat-value">{{ careerTotals.overtimeLosses || 0 }}</td>
                <td class="stat-value">{{ careerTotals.goals }}</td>
                <td class="stat-value">{{ careerTotals.assists }}</td>
                <td class="stat-value">{{ careerTotals.points }}</td>
                <td class="stat-value">{{ careerTotals.plusMinus }}</td>
                <td class="stat-value">{{ careerTotals.shots }}</td>
                <td class="stat-value">{{ careerTotals.hits }}</td>
                <td class="stat-value">{{ careerTotals.pim }}</td>
                <td class="stat-value">{{ careerTotals.ppg }}</td>
                <td class="stat-value">{{ careerTotals.shg }}</td>
                <td class="stat-value">{{ careerTotals.gwg }}</td>
                <td class="stat-value">{{ careerTotals.faceoffsWon }}</td>
                <td class="stat-value">{{ careerTotals.faceoffsLost }}</td>
                <td class="stat-value">{{ careerTotals.blockedShots }}</td>
                <td class="stat-value">{{ careerTotals.interceptions }}</td>
                <td class="stat-value">{{ careerTotals.takeaways }}</td>
                <td class="stat-value">{{ careerTotals.giveaways }}</td>
                <td class="stat-value">{{ careerTotals.deflections }}</td>
                <td class="stat-value">{{ careerTotals.penaltiesDrawn }}</td>
                <td class="stat-value">{{ careerTotals.shotAttempts }}</td>
                <td class="stat-value">{{ (careerTotals.shotPct || 0) | number:'1.1-1' }}%</td>
                <td class="stat-value">{{ careerTotals.passAttempts }}</td>
                <td class="stat-value">{{ careerTotals.passesCompleted }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Game-by-Game Stats Section -->
    <div class="game-stats-section">
      <h2>Game-by-Game Statistics</h2>
      
      <!-- Loading State -->
      <div *ngIf="loadingGameStats" class="loading-state">
        <div class="spinner"></div>
        <p>Loading game statistics...</p>
      </div>
      
      <!-- No Games Played Message -->
      <div *ngIf="!loadingGameStats && gameByGameStats.length === 0" class="no-games-message">
        <p>No games played yet this season.</p>
      </div>
      
      <!-- Game Stats Table -->
      <div *ngIf="!loadingGameStats && gameByGameStats.length > 0" class="game-stats-table-container">
        <table class="game-stats-table">
            <thead>
              <tr>
                <th>Date</th>
                <th class="club-header">Club</th>
                <th>Opponent</th>
                <th>Result</th>
                <th>G</th>
                <th>A</th>
                <th>P</th>
                <th>+/-</th>
                <th>S</th>
                <th>H</th>
                <th>PIM</th>
                <th>PPG</th>
                <th>SHG</th>
                <th>GWG</th>
                <th>FO Won</th>
                <th>FO Lost</th>
                <th>BS</th>
                <th>INT</th>
                <th>TK</th>
                <th>GV</th>
                <th>DEF</th>
                <th>PD</th>
                <th>SA</th>
                <th>Shot %</th>
                <th>PA</th>
                <th>PC</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let game of gameByGameStats" class="game-row">
                <td class="game-date">{{ formatGameDate(game.date) }}</td>
                <td class="game-club">
                  <div class="club-info">
                    <img [src]="game.teamLogoUrl" [alt]="game.team" class="club-logo" onerror="this.style.display='none'">
                    <span class="club-name">{{ game.team }}</span>
                  </div>
                </td>
                <td class="game-opponent">
                  <div class="opponent-info">
                    <img [src]="game.opponentLogoUrl" [alt]="game.opponent" class="club-logo" onerror="this.style.display='none'">
                    <span class="opponent-name">{{ game.opponent }}</span>
                  </div>
                </td>
                <td class="game-result" [ngClass]="game.result">
                  <div class="result-info">
                    <span class="result-letter">{{ game.result === 'W' ? 'W' : game.result === 'L' ? 'L' : 'OTL' }}</span>
                    <span class="final-score">({{ game.team === game.homeTeam ? game.homeScore : game.awayScore }}-{{ game.team === game.homeTeam ? game.awayScore : game.homeScore }})</span>
                  </div>
                </td>
                <td class="stat-value">{{ game.goals }}</td>
                <td class="stat-value">{{ game.assists }}</td>
                <td class="stat-value">{{ game.points }}</td>
                <td class="stat-value" [ngClass]="game.plusMinus > 0 ? 'positive' : game.plusMinus < 0 ? 'negative' : ''">{{ game.plusMinus > 0 ? '+' : '' }}{{ game.plusMinus }}</td>
                <td class="stat-value">{{ game.shots }}</td>
                <td class="stat-value">{{ game.hits }}</td>
                <td class="stat-value">{{ game.pim }}</td>
                <td class="stat-value">{{ game.ppg }}</td>
                <td class="stat-value">{{ game.shg }}</td>
                <td class="stat-value">{{ game.gwg }}</td>
                <td class="stat-value">{{ game.faceoffsWon }}</td>
                <td class="stat-value">{{ game.faceoffsLost }}</td>
                <td class="stat-value">{{ game.blockedShots }}</td>
                <td class="stat-value">{{ game.interceptions }}</td>
                <td class="stat-value">{{ game.takeaways }}</td>
                <td class="stat-value">{{ game.giveaways }}</td>
                <td class="stat-value">{{ game.deflections }}</td>
                <td class="stat-value">{{ game.penaltiesDrawn }}</td>
                <td class="stat-value">{{ game.shotAttempts }}</td>
                <td class="stat-value">{{ game.shotPercentage | number:'1.1-1' }}%</td>
                <td class="stat-value">{{ game.passAttempts }}</td>
                <td class="stat-value">{{ game.passes }}</td>
              </tr>
            </tbody>
          </table>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button routerLink="/players" class="back-button">Back to Players</button>
      <!-- Removed Edit Profile button -->
      <!-- <a *ngIf="player" [routerLink]="['/edit-profile', player.id]" class="btn btn-secondary">Edit Profile</a> -->
      <!-- Add more action buttons here based on user role (e.g., GM actions) -->
    </div>
  </div>
</div> 